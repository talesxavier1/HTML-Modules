
import { Splitter } from "./UI/splitter/Splitter";
import { Diagram } from "./UI/Diagram/Diagram";
import { TDiagramShapeClicked } from "./Types/TDiagramShapeClicked";
import { OptionsUI } from "./UI/Options/OptionsUI";

const diagramHTML = await (async () => {
    const response = await fetch("./html/Splitter/Diagram.html");
    if (response.ok) {
        return await response.text();
    } else {
        throw new Error("./html/Splitter/Diagram.html não encontrado.")
    }
})();

const optionsHTML = await (async () => {
    const response = await fetch("./html/Splitter/Options.html");
    if (response.ok) {
        return await response.text();
    } else {
        throw new Error("./html/Options.html não encontrado.")
    }
})();

let splitter: Splitter;
let diagram: Diagram;
let optionsUI: OptionsUI;
const main = async (): Promise<void> => {
    splitter = new Splitter(diagramHTML, optionsHTML);
    diagram = new Diagram();
    optionsUI = new OptionsUI();

    diagram.setDiagramOptions(JSON.stringify(diagramProps), diagramData);

    splitter.onResizeEnd = () => {
        diagram.repaint();
    }

    diagram.shapeClicked = (Event: TDiagramShapeClicked) => {
        optionsUI.mountOptions(Event.shapeData);
    }

}

const diagramProps: any = { "page": { "width": 25173, "height": 23812, "pageColor": -1, "pageWidth": 8391, "pageHeight": 11906, "pageLandscape": false }, "connectors": [{ "key": "107", "dataKey": "2268c9c3-6fde-1852-dea7-801a676a50a4", "locked": false, "zIndex": 0, "points": [{ "x": 4892, "y": 10110 }, { "x": 5447, "y": 10185 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 4892, "y": 10110, "pointIndex": 0, "skipped": false }, { "x": 5169.5, "y": 10110, "pointIndex": -1, "skipped": false }, { "x": 5169.5, "y": 10185, "pointIndex": -1, "skipped": false }, { "x": 5447, "y": 10185, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "100", "beginConnectionPointIndex": 0, "endItemKey": "101", "endConnectionPointIndex": 1 }, { "key": "108", "dataKey": "b4b0e30e-a464-ebee-b8bd-b7de245aa1b3", "locked": false, "zIndex": 0, "points": [{ "x": 7607, "y": 10185 }, { "x": 8237, "y": 10215 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 7607, "y": 10185, "pointIndex": 0, "skipped": false }, { "x": 7922, "y": 10185, "pointIndex": -1, "skipped": false }, { "x": 7922, "y": 10215, "pointIndex": -1, "skipped": false }, { "x": 8237, "y": 10215, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "101", "beginConnectionPointIndex": 0, "endItemKey": "102", "endConnectionPointIndex": 1 }, { "key": "109", "dataKey": "9c88a6e0-a4c7-b9d8-2609-e81891e99bb6", "locked": false, "zIndex": 0, "points": [{ "x": 8957, "y": 10215 }, { "x": 10217, "y": 9030 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 8957, "y": 10215, "pointIndex": 0, "skipped": false }, { "x": 9587, "y": 10215, "pointIndex": -1, "skipped": false }, { "x": 9587, "y": 9030, "pointIndex": -1, "skipped": false }, { "x": 10217, "y": 9030, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "102", "beginConnectionPointIndex": 0, "endItemKey": "103", "endConnectionPointIndex": 1 }, { "key": "110", "dataKey": "c9b09ddd-d98d-54e2-cf7d-87051e4a3a7e", "locked": false, "zIndex": 0, "points": [{ "x": 8957, "y": 10215 }, { "x": 10337, "y": 11520 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 8957, "y": 10215, "pointIndex": 0, "skipped": false }, { "x": 9647, "y": 10215, "pointIndex": -1, "skipped": false }, { "x": 9647, "y": 11520, "pointIndex": -1, "skipped": false }, { "x": 10337, "y": 11520, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "102", "beginConnectionPointIndex": -1, "endItemKey": "104", "endConnectionPointIndex": -1 }, { "key": "112", "dataKey": "0755a86c-2c9e-1182-1902-a1b8bf706a17", "locked": false, "zIndex": 0, "points": [{ "x": 12377, "y": 9030 }, { "x": 15795, "y": 8895 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 12377, "y": 9030, "pointIndex": 0, "skipped": false }, { "x": 14086, "y": 9030, "pointIndex": -1, "skipped": false }, { "x": 14086, "y": 8895, "pointIndex": -1, "skipped": false }, { "x": 15795, "y": 8895, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "103", "beginConnectionPointIndex": 0, "endItemKey": "105", "endConnectionPointIndex": 1 }, { "key": "124", "dataKey": "626b50cc-5574-8311-52db-2b66225ba76d", "locked": false, "zIndex": 0, "points": [{ "x": 12497, "y": 11520 }, { "x": 13382, "y": 11464 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 12497, "y": 11520, "pointIndex": 0, "skipped": false }, { "x": 12939.5, "y": 11520, "pointIndex": -1, "skipped": false }, { "x": 12939.5, "y": 11464, "pointIndex": -1, "skipped": false }, { "x": 13382, "y": 11464, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "104", "beginConnectionPointIndex": 0, "endItemKey": "123", "endConnectionPointIndex": 2 }, { "key": "126", "dataKey": "c446cdcb-599d-e64e-bc73-f81b1211a959", "locked": false, "zIndex": 0, "points": [{ "x": 13742, "y": 11824 }, { "x": 14731, "y": 13249 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 13742, "y": 11824, "pointIndex": 0, "skipped": false }, { "x": 13742, "y": 13249, "pointIndex": -1, "skipped": false }, { "x": 14731, "y": 13249, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "123", "beginConnectionPointIndex": 0, "endItemKey": "125", "endConnectionPointIndex": 1 }, { "key": "128", "dataKey": "a4324ca4-8585-b429-1a57-a61713caf6ef", "locked": false, "zIndex": 0, "points": [{ "x": 14102, "y": 11464 }, { "x": 14792, "y": 11269 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 14102, "y": 11464, "pointIndex": 0, "skipped": false }, { "x": 14447, "y": 11464, "pointIndex": -1, "skipped": false }, { "x": 14447, "y": 11269, "pointIndex": -1, "skipped": false }, { "x": 14792, "y": 11269, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "123", "beginConnectionPointIndex": 1, "endItemKey": "127", "endConnectionPointIndex": 1 }, { "key": "135", "dataKey": "fda19112-b12c-2378-786b-529399d4606a", "locked": false, "zIndex": 0, "points": [{ "x": 16515, "y": 8895 }, { "x": 17101, "y": 8929 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 16515, "y": 8895, "pointIndex": 0, "skipped": false }, { "x": 16808, "y": 8895, "pointIndex": -1, "skipped": false }, { "x": 16808, "y": 8929, "pointIndex": -1, "skipped": false }, { "x": 17101, "y": 8929, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "105", "beginConnectionPointIndex": 0, "endItemKey": "132", "endConnectionPointIndex": 1 }, { "key": "136", "dataKey": "7d44e285-872c-aebe-daea-49c6bd5e6df2", "locked": false, "zIndex": 0, "points": [{ "x": 17821, "y": 8929 }, { "x": 18496, "y": 7534 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 17821, "y": 8929, "pointIndex": 0, "skipped": false }, { "x": 18158.5, "y": 8929, "pointIndex": -1, "skipped": false }, { "x": 18158.5, "y": 7534, "pointIndex": -1, "skipped": false }, { "x": 18496, "y": 7534, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "132", "beginConnectionPointIndex": 0, "endItemKey": "133", "endConnectionPointIndex": 1 }, { "key": "137", "dataKey": "475bc3b3-3c4e-a19a-129a-e4b74fa68023", "locked": false, "zIndex": 0, "points": [{ "x": 17821, "y": 8929 }, { "x": 18646, "y": 10309 }], "context": { "actualRoutingMode": 0, "lockCreateRenderPoints": false, "renderPoints": [{ "x": 17821, "y": 8929, "pointIndex": 0, "skipped": false }, { "x": 18233.5, "y": 8929, "pointIndex": -1, "skipped": false }, { "x": 18233.5, "y": 10309, "pointIndex": -1, "skipped": false }, { "x": 18646, "y": 10309, "pointIndex": 1, "skipped": false }] }, "beginItemKey": "132", "beginConnectionPointIndex": -1, "endItemKey": "134", "endConnectionPointIndex": -1 }], "shapes": [{ "key": "71", "dataKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "locked": false, "zIndex": 0, "type": "processContainer", "text": "", "x": 2601, "y": 3473, "width": 22544.999999999996, "height": 10991, "childKeys": ["100", "101", "102", "103", "104", "107", "108", "109", "110", "106", "123", "124", "125", "126", "127", "128", "105", "112", "132", "133", "134", "135", "136", "137", "138"] }, { "key": "100", "dataKey": "779c0104-62be-474d-80a8-b32e822ae0f5", "locked": false, "zIndex": 0, "type": "startProcess", "text": "", "x": 4172, "y": 9750, "width": 720, "height": 720 }, { "key": "101", "dataKey": "c43f6791-60d8-497f-9c4c-b79418c21515", "locked": false, "zIndex": 0, "type": "script", "text": "", "x": 5447, "y": 9465, "width": 2160, "height": 1440 }, { "key": "102", "dataKey": "65846fb6-eadd-40df-af7f-420af10188a1", "locked": false, "zIndex": 0, "type": "multicastIn", "text": "", "x": 8237, "y": 9855, "width": 720, "height": 720 }, { "key": "103", "dataKey": "25b956c8-6fe7-456d-a3a9-396b9b7a5948", "locked": false, "zIndex": 0, "type": "script", "text": "", "x": 10217, "y": 8310, "width": 2160, "height": 1440 }, { "key": "104", "dataKey": "c76932d6-feb9-4f06-b7ec-36e2f34aef4c", "locked": false, "zIndex": 0, "type": "script", "text": "", "x": 10337, "y": 10800, "width": 2160, "height": 1440 }, { "key": "105", "dataKey": "866f89d7-d03c-45ea-8384-5da786cef71f", "locked": false, "zIndex": 0, "type": "multicastOut", "text": "", "x": 15795, "y": 8535, "width": 720, "height": 720 }, { "key": "106", "dataKey": "19a09d01-aa96-42a7-ba18-7d5b3753743e", "locked": false, "zIndex": 0, "type": "endProcess", "text": "", "x": 15437, "y": 5580, "width": 720, "height": 720 }, { "key": "123", "dataKey": "5a0cc135-9e35-4cb9-b62d-7351dff213ea", "locked": false, "zIndex": 0, "type": "condition", "text": "", "x": 13382, "y": 11104, "width": 720, "height": 720 }, { "key": "125", "dataKey": "f003f722-7c2e-440e-a3b4-755e47189632", "locked": false, "zIndex": 0, "type": "script", "text": "", "x": 14731, "y": 12529, "width": 2160, "height": 1440 }, { "key": "127", "dataKey": "23c4280a-a9cf-4e6f-9c57-1c89da730eb1", "locked": false, "zIndex": 0, "type": "script", "text": "", "x": 14792, "y": 10549, "width": 2160, "height": 1440 }, { "key": "132", "dataKey": "65fee9c2-891e-4e98-bf88-990e7f1ad325", "locked": false, "zIndex": 0, "type": "multicastIn", "text": "", "x": 17101, "y": 8569, "width": 720, "height": 720 }, { "key": "133", "dataKey": "997ab423-c0fa-4b9f-b282-a36c417e089c", "locked": false, "zIndex": 0, "type": "script", "text": "", "x": 18496, "y": 6814, "width": 2160, "height": 1440 }, { "key": "134", "dataKey": "e1287b7c-c0d7-459d-a98d-b9db768ee307", "locked": false, "zIndex": 0, "type": "script", "text": "", "x": 18646, "y": 9589, "width": 2160, "height": 1440 }, { "key": "138", "dataKey": "b966f3fe-f20a-44e6-9357-408891629639", "locked": false, "zIndex": 0, "type": "multicastOut", "text": "", "x": 22277, "y": 8464, "width": 720, "height": 720 }] }

const diagramData: any = [{ "ID": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "type": "processContainer", "text": "", "shapeType": "processContainer", "_initialized": true, "name": "" }, { "ID": "779c0104-62be-474d-80a8-b32e822ae0f5", "type": "startProcess", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "startProcess", "_initialized": true }, { "ID": "c43f6791-60d8-497f-9c4c-b79418c21515", "type": "script", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "script", "_initialized": true }, { "ID": "65846fb6-eadd-40df-af7f-420af10188a1", "type": "multicastIn", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "multicastIn", "_initialized": true, "trackName": "777" }, { "ID": "25b956c8-6fe7-456d-a3a9-396b9b7a5948", "type": "script", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "script", "_initialized": true }, { "ID": "c76932d6-feb9-4f06-b7ec-36e2f34aef4c", "type": "script", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "script", "_initialized": true }, { "ID": "866f89d7-d03c-45ea-8384-5da786cef71f", "type": "multicastOut", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "multicastOut", "_initialized": true, "trackNameOrigin": "777" }, { "ID": "19a09d01-aa96-42a7-ba18-7d5b3753743e", "type": "endProcess", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "endProcess", "_initialized": true }, { "ID": "5a0cc135-9e35-4cb9-b62d-7351dff213ea", "type": "condition", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "condition", "_initialized": true }, { "ID": "f003f722-7c2e-440e-a3b4-755e47189632", "type": "script", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "script", "_initialized": true }, { "ID": "23c4280a-a9cf-4e6f-9c57-1c89da730eb1", "type": "script", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "shapeType": "script", "_initialized": true }, { "type": "multicastIn", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "ID": "65fee9c2-891e-4e98-bf88-990e7f1ad325", "shapeType": "multicastIn", "_initialized": true, "trackName": "asddds" }, { "type": "script", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "ID": "997ab423-c0fa-4b9f-b282-a36c417e089c", "shapeType": "script", "_initialized": true }, { "type": "script", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "ID": "e1287b7c-c0d7-459d-a98d-b9db768ee307", "shapeType": "script", "_initialized": true }, { "type": "multicastOut", "text": "", "containerKey": "cdc4371d-631d-4f1f-9de0-ef4bff9dbe83", "ID": "b966f3fe-f20a-44e6-9357-408891629639", "shapeType": "multicastOut", "_initialized": true, "trackNameOrigin": "asddds" }]

$(() => {
    main();
})

